

 // sample
// This answer was a godsend: https://stackoverflow.com/questions/38621387/php-soap-send-envelope-to-wsdl

// Set unchangable globals
define("apiName", "WebDesign_3E_U");
define("apiPass", "W3bd3s1gn20160616");

initialize();

echo '<hr />';

/** ------------------------------------------------ **/
/** ------- | FUNCTIONS GO BELOW THIS LINE | ------- **/
/** ------------------------------------------------ **/

function initialize() { // Function that should run at startup...

    global $client, $data;

    // Start the session
    session_start();

    $code = new StdClass;
    $code->AccessibleCarrierCode = "3E";

    $data = new StdClass;
    $data->CarrierCodes = array($code);

    $data->LogonID = apiName;
    $data->Password = apiPass;

    $client = new SoapClient("http://3e.connectpoint.uat.radixx.com/ConnectPoint.Security.svc?singleWsdl");

    // If there's not a token set, let's get one...
    if (!isset($_SESSION["token"])) {
        $_SESSION["token"] = getToken();
        echo 'Token Created!<br />';
        echo $_SESSION["token"];
    }

    // We don't need a token. We already have one! Let's VALIDATE THIS and then continue.
    else {

        if (validateToken($_SESSION["token"])) {
            echo 'Token is good ('.$_SESSION["token"].')';
        }

        else {
            echo 'Token expired ('.$_SESSION["token"].'). Refresh for new token';
            $_SESSION["token"] = null;
        }

    }
}

function getToken() {

    global $client, $data;

    //var_dump($client->__getFunctions());
    $response = $client->RetrieveSecurityToken(array("RetrieveSecurityTokenRequest" => $data));

    $token = null;
    if (!empty($response->RetrieveSecurityTokenResult->SecurityToken)) {
        $token = $response->RetrieveSecurityTokenResult->SecurityToken;
    } else {
        $token = false;
    }
    return $token;
}

function validateToken($token) {

    global $client, $data;

    $data->SecurityToken = $token;
    $validate = $client->ValidateSecurityToken(array("ValidateSecurityTokenRequest" => $data));

    if (!empty($validate->ValidateSecurityTokenResult->ValidationResult)) {
        $response = true;
    } else {
        $response = false;
    }

    //var_dump($client->__getFunctions());
    return $response;
}

$code = new StdClass;
	$code->AccessibleCarrierCode = "FZ";

	$data = new StdClass;
	$data->CarrierCodes = array($code);

	$data->LogonID = "xxxxx";
	$data->Password = "xxxxx";

	$client = new SoapClient("http://3e.connectpoint.uat.radixx.com/ConnectPoint.Flight.svc?wsdl", true);
	$response = $client->RetrieveSecurityToken(array("RetrieveSecurityTokenRequest" => $data));

	var_dump($response);
